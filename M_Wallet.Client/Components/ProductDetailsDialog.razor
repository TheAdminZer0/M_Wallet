@using M_Wallet.Shared
@using MudBlazor
@inject IDialogService DialogService

<MudDialog>
    <DialogContent>
        <MudGrid>
            <MudItem xs="12" sm="6">
                @if (!string.IsNullOrEmpty(Product.ImageUrl))
                {
                    <MudTooltip Text="Click to zoom">
                        <div @onclick="OpenZoomDialog" style="cursor: pointer; transition: transform 0.2s;" class="hover-zoom">
                            <MudImage Src="@Product.ImageUrl" Alt="@Product.Name" ObjectFit="ObjectFit.Cover" Height="300" Fluid="true" Class="rounded-lg" />
                        </div>
                    </MudTooltip>
                }
                else
                {
                    <div class="d-flex justify-center align-center rounded-lg" style="height: 300px; background-color: var(--mud-palette-grey-lighter);">
                        <MudIcon Icon="@Icons.Material.Filled.Image" Size="Size.Large" Color="Color.Default" />
                    </div>
                }
            </MudItem>
            <MudItem xs="12" sm="6">
                <MudText Typo="Typo.h5" Class="mb-2">@Product.Name</MudText>
                
                <MudText Typo="Typo.h4" Color="Color.Primary" Class="mb-4">
                    LD @Product.Price.ToString("F2")
                </MudText>

                <MudText Typo="Typo.body1" Class="mb-2">
                    <strong>Stock:</strong> 
                    <MudChip T="string" Size="Size.Small" Color="@(Product.StockQuantity > 10 ? Color.Success : Color.Warning)">
                        @Product.StockQuantity
                    </MudChip>
                </MudText>

                <MudText Typo="Typo.body1" Class="mb-2">
                    <strong>Total Sold:</strong> @Product.TotalSoldQuantity
                </MudText>

                @if (!string.IsNullOrEmpty(Product.Description))
                {
                    <MudText Typo="Typo.body1" Class="mb-2"><strong>Description:</strong></MudText>
                    <MudText Typo="Typo.body2" Class="mb-4">@Product.Description</MudText>
                }

                @if (Product.Barcodes != null && Product.Barcodes.Any())
                {
                    <MudText Typo="Typo.body1" Class="mb-2"><strong>Barcodes:</strong></MudText>
                    <div class="d-flex flex-wrap gap-1">
                        @foreach (var barcode in Product.Barcodes)
                        {
                            <MudChip T="string" Variant="Variant.Outlined" Size="Size.Small">@barcode.Barcode</MudChip>
                        }
                    </div>
                }
            </MudItem>
        </MudGrid>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">Close</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] IMudDialogInstance MudDialog { get; set; } = default!;
    [Parameter] public Product Product { get; set; } = default!;

    private void Cancel() => MudDialog.Cancel();

    private async Task OpenZoomDialog()
    {
        if (string.IsNullOrEmpty(Product.ImageUrl)) return;

        var parameters = new DialogParameters { ["ImageUrl"] = Product.ImageUrl };
        var options = new DialogOptions 
        { 
            CloseButton = true, 
            MaxWidth = MaxWidth.ExtraLarge, 
            FullWidth = true,
            BackgroundClass = "mud-theme-dark" 
        };
        await DialogService.ShowAsync<ImageDialog>("Product Image", parameters, options);
    }
}
